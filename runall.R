# The purpose of this script is to run the new FIM.
# test
# test
# Lorae Stojanovic
# LE: 12/28/2023

library(magrittr)

# Let's start by initializing some mock data and performing MPC calculations on it.

data <- data.frame(
  date = as.Date(c('1970-03-31', '1970-06-30', '1970-09-30', '1970-12-31', '1971-03-31', '1971-06-30', '1971-09-30', '1971-12-31', '1972-03-31', '1972-06-30', '1972-09-30', '1972-12-31', '1973-03-31', '1973-06-30', '1973-09-30', '1973-12-31', '1974-03-31', '1974-06-30', '1974-09-30', '1974-12-31', '1975-03-31', '1975-06-30', '1975-09-30', '1975-12-31', '1976-03-31', '1976-06-30', '1976-09-30', '1976-12-31', '1977-03-31', '1977-06-30', '1977-09-30', '1977-12-31', '1978-03-31', '1978-06-30', '1978-09-30', '1978-12-31', '1979-03-31', '1979-06-30', '1979-09-30', '1979-12-31', '1980-03-31')),
  disburse1 = c(144, 147, 164, 167, 167, 109, 183, 121, 136, 187, 170, 188, 188, 112, 158, 165, 139, 187, 146, 188, 181, 137, 125, 177, 172, 109, 120, 180, 169, 179, 147, 164, 182, 199, 188, 149, 129, 119, 119, 114, 139),
  disburse2 = c(132, 165, 109, 157, 132, 131, 174, 123, 135, 175, 155, 128, 134, 100, 100, 136, 153, 105, 138, 117, 179, 104, 142, 158, 131, 101, 165, 141, 157, 135, 111, 146, 182, 191, 100, 114, 199, 153, 112, 142, 184),
  disburse3 = c(175, 168, 106, 168, 147, 103, 176, 152, 178, 115, 120, 199, 158, 123, 179, 113, 185, 148, 149, 169, 141, 135, 164, 195, 169, 194, 100, 150, 136, 134, 148, 193, 103, 198, 142, 177, 121, 173, 100, 110, 143),
  disburse4 = c(158, 123, 159, 102, 198, 162, 135, 194, 167, 182, 146, 199, 120, 181, 150, 127, 114, 141, 158, 165, 136, 110, 186, 143, 111, 102, 151, 180, 132, 154, 100, 138, 119, 146, 142, 156, 160, 177, 130, 124, 102)
)

mpc <- data.frame( # make the columns
  disburse1 = c(0.5, 0.2, 0.1, 0.05, 0.05, 0.05, 0.03, 0.02, 0, 0, 0, 0),
  disburse2 = c(rep(0.1, times = 10), 0, 0),
  disburse3 = c(1, rep(0, times = 11)),
  disburse4 = c(0.3, 0.2, 0.1, 0.05, 0.05, 0.02, 0.02, 0.02, 0.02, 0.02, 0, 0)
)
# ) %>%
#   t(.) # transpose it to rows

mpc <- function (x, # A vector of cash disbursement data
                 mpc) { # A vector of MPCs
  roll::roll_sum(x, 
                 width = length(mpc), 
                 weights = rev(mpc), 
                 online = FALSE, 
                 min_obs = 1) }

mpc(data$disburse1, mpc$disburse1)
